version: '3'
name: Union-des-rolistes

services:
  bot:
    build: ./bot #utilise le dockerfile pour cree le container a utiliser
    container_name: bot_base
    restart: always #redemarre le container si il s'eteint
    environment:
      - DISCORD_TOKEN=----------------------------------------- #token pour comm avec discord
      - BOT_PREFIX=$ #prefix pour les commandes
    volumes:
      - ./Bot/extends/base:/app/extends/base #dossier ou est l'extension de la base
  api:
    build: ./api #utilise le dockerfile pour cree le container a utiliser
    container_name: api_base
    ports:
      - "3000:3000"
    restart: always #redemarre le container si il s'eteint
    environment:
      #reuse les variables d'environnement du container bot_base
      - DISCORD_TOKEN=-------------------------------------------
      - PYTHONUNBUFFERED=1 #get print of python
  php:
    image: php:8-apache
    build: ./apache #utilise le dockerfile pour cree le container a utiliser
    container_name: php_base
    # environment:
    #   - APACHE_HTTP_PORT_NUMBER=80
    volumes:
      #  - ./apache/default-httpd.conf:/etc/apache2/apache2.conf:ro # si besoin de modifier le fichier de conf apache (normalement pas besoin)
      - ./apache/vhost/000_api.conf:/etc/apache2/sites-enabled/000_api.conf:ro #fichier de conf apache pour l'api
    ports:
      - "80:80"
    links:
      - api
    restart: always
    depends_on:
      # attend le lancement de ces containers avant de lancer le container
      - bot
      - api
